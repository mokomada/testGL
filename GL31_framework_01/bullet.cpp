/******************************************************************************
*	ファイル：弾
*	作成者  ：庄司茜
*	作成日  ：
******************************************************************************/
/******************************************************************************
*	インクルードファイル
******************************************************************************/

#include "main.h"
#include "manager.h"
#include "rendererGL.h"
#include "bullet.h"
#include "game.h"
#include "sceneModel.h"
#include "effect2D.h"

/******************************************************************************
*	マクロ定義
******************************************************************************/

#define BULLET_LIFE ( 120 )

/******************************************************************************
*	構造体定義
******************************************************************************/
/******************************************************************************
*	プロトタイプ宣言
******************************************************************************/
/******************************************************************************
*	グローバル変数
******************************************************************************/

/******************************************************************************
*	関数名：
*	引数  ：なし
*	戻り値：なし
*	説明  ：コンストラクタ
******************************************************************************/
CBullet::CBullet( int priority , OBJTYPE objType )
{
	m_speed = 0;
}
/******************************************************************************
*	関数名：
*	引数  ：なし
*	戻り値：なし
*	説明  ：デストラクタ
******************************************************************************/
CBullet::~CBullet()
{
}

/******************************************************************************
*	関数名：
*	引数  ：
*	戻り値：
*	説明  ：クリエイト
******************************************************************************/
CBullet * CBullet::Create( VECTOR3 pos , VECTOR3 rot , float speed )
{
	CBullet *bullet = new CBullet();
	bullet->Init( pos , rot , speed );

	return bullet;
}

/******************************************************************************
*	関数名：
*	引数  ：
*	戻り値：HRESULT
*	説明  ：初期化処理
******************************************************************************/
void CBullet::Init( VECTOR3 pos , VECTOR3 rot , float speed )
{
	CSceneBillboardGL::Init( pos , VECTOR2( 50.0f , 50.0f ) , "./data/TEXTURE/bullet000.png");
	m_Rot = rot;				//発射角度
	m_speed = speed;			//移動速度
	m_life = BULLET_LIFE;	//弾の寿命
}

/******************************************************************************
*	関数名：
*	引数  ：なし
*	戻り値：なし
*	説明  ：終了処理
******************************************************************************/
void CBullet::Uninit( void )
{
	CSceneBillboardGL::Uninit();
}

/******************************************************************************
*	関数名：
*	引数  ：なし
*	戻り値：なし
*	説明  ：更新処理
******************************************************************************/
void CBullet::Update( void )
{
	m_life--;

	m_Pos.x -= -sinf( m_Rot.y ) * m_speed;
	m_Pos.z -= -cosf( m_Rot.y ) * m_speed;

	if( m_life <= 0 )	//寿命が尽きたら削除
	{
		CEffect2D::Create(m_Pos,VECTOR2(100.0f,100.0f),ETYPE_EXPLODE00);
		CSceneGL::Release();
	}
}

/******************************************************************************
*	関数名：
*	引数  ：なし
*	戻り値：なし
*	説明  ：描画処理
******************************************************************************/
void CBullet::Draw( void )
{
	CSceneBillboardGL::Draw();
}
